From 8341b9ea6b889a887577772f6adfb49e1fea1bc1 Mon Sep 17 00:00:00 2001
From: Bin Yang <robin.yb@huawei.com>
Date: Tue, 16 Jul 2019 14:39:27 +0800
Subject: [PATCH 15/24] add object in kpatch

it is required by make_hotpatch users

Signed-off-by: Bin Yang <robin.yb@huawei.com>
---
 kpatch-build/kpatch-build | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/kpatch-build/kpatch-build b/kpatch-build/kpatch-build
index a0d8ba8..c21f3ca 100755
--- a/kpatch-build/kpatch-build
+++ b/kpatch-build/kpatch-build
@@ -1227,6 +1227,8 @@ echo -n "Patched objects:"
 for i in $(echo "${objnames[@]}" | tr ' ' '\n' | sort -u | tr '\n' ' ')
 do
 	echo -n " $i"
+	echo -n " $(basename $i)"
+	echo -n "$(basename $i)" >> $TEMPDIR/patch/object
 done
 echo
 
@@ -1353,6 +1355,7 @@ UNDEFINED=$(comm -23 <(sort -u "${TEMPDIR}"/undefined_references) \
 [[ -z "$USERMODBUILDDIR" ]] && [[ -n "$UNDEFINED" ]] && die "Undefined symbols: $UNDEFINED"
 
 cp -f "$TEMPDIR/patch/$MODNAME.ko" "$BASE" || die
+cp -f "$TEMPDIR/patch/object" "$BASE" || die
 
 [[ "$DEBUG" -eq 0 && "$SKIPCLEANUP" -eq 0 ]] && rm -f "$LOGFILE"
 
-- 
2.23.0

