From 0a92ec9f158340501151bf350050597414affece Mon Sep 17 00:00:00 2001
From: Zhipeng Xie <xiezhipeng1@huawei.com>
Date: Fri, 2 Nov 2018 17:24:58 +0000
Subject: [PATCH 1007/1015] create-diff-object: don't create dynamic reloc for
 symbol exported by patch itself

when a patch export a new function, ___kcrctab+xxx has a reloc,
use origin reloc to get right symbol version.

Signed-off-by: Zhipeng Xie <xiezhipeng1@huawei.com>
---
 kpatch-build/create-diff-object.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/kpatch-build/create-diff-object.c b/kpatch-build/create-diff-object.c
index bd7dd37..349e483 100644
--- a/kpatch-build/create-diff-object.c
+++ b/kpatch-build/create-diff-object.c
@@ -2808,6 +2808,9 @@ static void kpatch_create_intermediate_sections(struct kpatch_elf *kelf,
 					if (!strcmp(sym_objname, "vmlinux"))
 						continue;
 
+					if (!strcmp(sym_objname, pmod_name))
+						continue;
+
 					external = 1;
 				}
 			}
-- 
1.7.5.4

