From f162056f0448e676345e3205ef4b190f81b51295 Mon Sep 17 00:00:00 2001
From: Zhipeng Xie <xiezhipeng1@huawei.com>
Date: Thu, 12 Mar 2020 05:10:55 -0400
Subject: [PATCH 18/23] use original reloc for symbols from modules

symbols exported in a patch will generate a symbol version with
object module name in Module.symvers, but the symbol is actually
in patch module which cause livepatch symbol lookup failed.

Signed-off-by: Zhipeng Xie <xiezhipeng1@huawei.com>
---
 kpatch-build/create-diff-object.c | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/kpatch-build/create-diff-object.c b/kpatch-build/create-diff-object.c
index 20213a0..457d517 100644
--- a/kpatch-build/create-diff-object.c
+++ b/kpatch-build/create-diff-object.c
@@ -3141,10 +3141,8 @@ static void kpatch_create_intermediate_sections(struct kpatch_elf *kelf,
 					if (!strcmp(sym_objname, "vmlinux"))
 						continue;
 
-					if (!strcmp(sym_objname, objname))
-						continue;
-
 					external = 1;
+					continue;
 				}
 			}
 			log_debug("lookup for %s @ 0x%016lx len %lu\n",
-- 
2.18.1

